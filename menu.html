<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KRAVIN DELIVERY</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .cart-icon {
      position: fixed;
      top: 20px;
      right: 20px;
      cursor: pointer;
    }
    #cart-count {
      background: red;
      color: white;
      border-radius: 50%;
      padding: 2px 8px;
      font-size: 14px;
      position: absolute;
      top: -8px;
      right: -8px;
      display: none;
    }
    #cart-dropdown {
      display: none;
      position: fixed;
      top: 50px;
      right: 20px;
      width: 300px;
      max-height: 400px;
      overflow-y: auto;
      background: #f9f9f9;
      border: 1px solid #ccc;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      padding: 10px;
      z-index: 1000;
    }
    #cart-dropdown div {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    #cart-dropdown img {
      width: 50px;
      height: 50px;
      object-fit: cover;
      margin-right: 10px;
      border-radius: 4px;
    }
    #cart-dropdown button.remove-item {
      margin-left: auto;
      background: transparent;
      border: none;
      font-size: 20px;
      color: #900;
      cursor: pointer;
    }
    #checkout-btn {
      display: none;
      margin-top: 10px;
      width: 100%;
      padding: 10px;
      background: #0070ba;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    #checkout-modal {
      display: none;
      position: fixed;
      top:0; left:0; right:0; bottom:0;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    #checkout-form {
      background: white;
      padding: 20px;
      border-radius: 8px;
      width: 400px;
      max-width: 90vw;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    #checkout-form input, #checkout-form textarea {
      padding: 8px;
      font-size: 14px;
      width: 100%;
      box-sizing: border-box;
    }
    #form-error {
      color: red;
      display: none;
    }
    #payment-success {
      display: none;
      color: green;
      font-weight: bold;
      margin-top: 10px;
    }
    #paypal-button-container {
      margin-top: 10px;
    }
    #pay-arrival-btn {
      margin-top: 10px;
      background: #25d366;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h1>KRAVIN DELIVERY</h1>

  <div class="cart-icon" onclick="toggleCart()" style="position:relative;">
    ðŸ›’ Cart
    <span id="cart-count">0</span>
  </div>

  <div id="cart-dropdown">
    <div id="cart-items">Your cart is empty.</div>
    <button id="checkout-btn" onclick="openCheckout()">Checkout with PayPal</button>
    <button id="pay-arrival-btn" onclick="payOnArrival()">Pay on Arrival via WhatsApp</button>
  </div>

  <!-- Checkout Modal -->
  <div id="checkout-modal">
    <form id="checkout-form">
      <h2>Checkout</h2>
      <label>
        Name:<br />
        <input type="text" name="name" required />
      </label>
      <label>
        Address:<br />
        <textarea name="address" required></textarea>
      </label>
      <label>
        Phone Number:<br />
        <input type="tel" name="phone" pattern="[0-9+\-\s]{7,15}" required />
      </label>
      <div id="form-error"></div>
      <div id="paypal-button-container"></div>
      <button type="button" onclick="closeCheckout()">Cancel</button>
    </form>
    <div id="payment-success">Payment successful! Thank you for your order.</div>
  </div>

  <!-- Include PayPal SDK -->
  <script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID&currency=USD"></script>

  <script>
    // Cart data stored in-memory
    let cart = [];

    // Example: loadMenu function - this would load menu items from your data source (not implemented here)
    function loadMenu(restaurant) {
      console.log("Loading menu for", restaurant);
      // For demo, let's add some items on load
      cart = [
        { name: "KFC Fried Chicken", price: "$5.99", quantity: 2, image: "https://via.placeholder.com/50" },
        { name: "KFC Fries", price: "$2.49", quantity: 1, image: "https://via.placeholder.com/50" }
      ];
      updateCartUI();
    }

    // Update cart UI
    function updateCartUI() {
      const countElem = document.getElementById("cart-count");
      const cartItemsElem = document.getElementById("cart-items");
      const checkoutBtn = document.getElementById("checkout-btn");

      // Update badge count
      const totalQuantity = cart.reduce((sum, item) => sum + item.quantity, 0);
      if (totalQuantity > 0) {
        countElem.style.display = "inline-block";
        countElem.textContent = totalQuantity;
        checkoutBtn.style.display = "block";
        document.getElementById("pay-arrival-btn").style.display = "block";
      } else {
        countElem.style.display = "none";
        checkoutBtn.style.display = "none";
        document.getElementById("pay-arrival-btn").style.display = "none";
      }

      // Show items in dropdown
      if (cart.length === 0) {
        cartItemsElem.innerHTML = "<p>Your cart is empty.</p>";
        return;
      }

      cartItemsElem.innerHTML = "";
      cart.forEach(item => {
        const itemDiv = document.createElement("div");
        itemDiv.innerHTML = `
          <img src="${item.image}" alt="${item.name}" />
          <div style="flex-grow:1;">
            <strong>${item.name}</strong><br/>
            ${item.price} x ${item.quantity}
          </div>
          <button class="remove-item" onclick="removeFromCart('${item.name}')">&times;</button>
        `;
        cartItemsElem.appendChild(itemDiv);
      });
    }

    // Remove item from cart
    function removeFromCart(name) {
      const index = cart.findIndex(i => i.name === name);
      if (index > -1) {
        cart.splice(index, 1);
        updateCartUI();
      }
    }

    // Toggle cart dropdown visibility
    function toggleCart() {
      const dropdown = document.getElementById("cart-dropdown");
      dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
    }

    // Close cart dropdown if clicking outside
    document.addEventListener('click', function(event) {
      const cartDropdown = document.getElementById('cart-dropdown');
      const cartIcon = document.querySelector('.cart-icon');
      if (!cartDropdown.contains(event.target) && !cartIcon.contains(event.target)) {
        cartDropdown.style.display = 'none';
      }
    });

    // Checkout modal and form elements
    const checkoutModal = document.getElementById("checkout-modal");
    const checkoutForm = document.getElementById("checkout-form");
    const formError = document.getElementById("form-error");
    const paymentSuccess = document.getElementById("payment-success");

    // Open checkout modal & render PayPal buttons
    function openCheckout() {
      formError.style.display = "none";
      paymentSuccess.style.display = "none";
      checkoutForm.style.display = "flex";
      checkoutModal.style.display = "flex";
      renderPayPalButtons();
    }

    // Close checkout modal and reset form
    function closeCheckout() {
      checkoutModal.style.display = "none";
      checkoutForm.reset();
      document.getElementById("paypal-button-container").innerHTML = "";
    }

    // Calculate total amount
    function calculateTotal() {
      let total = 0;
      cart.forEach(item => {
        const priceNum = parseFloat(item.price.replace(/[^0-9\.]/g, ""));
        if (!isNaN(priceNum)) {
          total += priceNum * item.quantity;
        }
      });
      return total.toFixed(2);
    }

    // Render PayPal buttons with validation
    function renderPayPalButtons() {
      const container = document.getElementById("paypal-button-container");
      container.innerHTML = "";

      paypal.Buttons({
        style: {
          layout: 'vertical',
          color:  'gold',
          shape:  'rect',
          label:  'paypal'
        },
        onClick: function(data, actions) {
          if (!checkoutForm.checkValidity()) {
            formError.textContent = "Please fill out all required fields correctly.";
            formError.style.display = "block";
            return actions.reject();
          }
          formError.style.display = "none";
          return actions.resolve();
        },
        createOrder: function(data, actions) {
          const total = calculateTotal();
          return actions.order.create({
            purchase_units: [{
              amount: {
                value: total
              },
              description: "KRAVIN DELIVERY order"
            }]
          });
        },
        onApprove: function(data, actions) {
          return actions.order.capture().then(function(details) {
            paymentSuccess.style.display = "block";
            checkoutForm.style.display = "none";

            // Here you could send order info to backend

            // Clear cart after payment success
            cart.length = 0;
            updateCartUI();
          });
        },
        onError: function(err) {
          formError.textContent = "Payment failed: " + err;
          formError.style.display = "block";
        }
      }).render("#paypal-button-container");
    }

    // Pay on arrival via WhatsApp
    function payOnArrival() {
      if (!checkoutForm.checkValidity()) {
        alert("Please fill out your details first.");
        openCheckout();
        return;
      }
      const formData = new FormData(checkoutForm);
      let message = "New KRAVIN DELIVERY Order:%0A";
      cart.forEach(item => {
        message += `- ${item.name} x${item.quantity} (${item.price})%0A`;
      });
      message += `%0AName: ${formData.get("name")}%0A`;
      message += `Address: ${formData.get("address")}%0A`;
      message += `Phone: ${formData.get("phone")}%0A`;
      message += `Payment: Pay on Arrival`;

      // WhatsApp number - replace with your business number including country code (no + sign)
      const whatsappNumber = "1234567890";

      const url = `https://wa.me/${whatsappNumber}?text=${message}`;

      // Open WhatsApp chat in new tab
      window.open(url, "_blank");
    }

    // Load default menu & initialize
    window.onload = () => loadMenu("KFC");

  </script>

</body>
</html>
