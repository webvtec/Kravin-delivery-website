<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>KRAVIN DELIVERY Checkout</title>
<style>
  body {
    font-family: Arial, sans-serif;
  }
  #checkout-modal {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.5);
    justify-content: center;
    align-items: center;
  }
  #checkout-modal.flex {
    display: flex;
  }
  #checkout-form {
    background: white;
    padding: 20px;
    border-radius: 6px;
    width: 320px;
    box-sizing: border-box;
  }
  #checkout-form label {
    display: block;
    margin-bottom: 10px;
  }
  #checkout-form input,
  #checkout-form textarea {
    width: 100%;
    padding: 8px;
    box-sizing: border-box;
  }
  #checkout-form button {
    width: 100%;
    padding: 12px;
    margin-top: 8px;
    font-size: 16px;
    cursor: pointer;
    border-radius: 4px;
    border: none;
  }
  #pay-upon-arrival-btn {
    background-color: #28a745; /* green */
    color: white;
  }
  #form-error {
    color: red;
    margin-top: 10px;
    display: none;
  }
  #payment-success {
    color: green;
    margin-top: 10px;
    display: none;
  }
  #paypal-button-container > div {
    margin-top: 10px;
  }
</style>
</head>
<body>

<!-- Your main content -->

<!-- Checkout Modal -->
<div id="checkout-modal">
  <form id="checkout-form">
    <h2>Checkout</h2>
    <label>
      Name:<br />
      <input type="text" name="name" required />
    </label>
    <label>
      Phone:<br />
      <input type="text" name="phone" required />
    </label>
    <label>
      Address:<br />
      <textarea name="address" rows="3" required></textarea>
    </label>

    <button type="button" id="pay-upon-arrival-btn">PAY UPON ARRIVAL</button>

    <div id="paypal-button-container"></div>

    <p id="form-error"></p>
    <p id="payment-success">Payment successful! Thank you for your order.</p>
  </form>
</div>

<script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID&currency=USD"></script>
<script>
  // Your cart array (mock example, replace with your actual cart logic)
  const cart = [
    { name: "Burger", price: "$5.99", quantity: 2, image: "burger.jpg" },
    { name: "Fries", price: "$2.49", quantity: 1, image: "fries.jpg" }
  ];

  function calculateTotal() {
    let total = 0;
    cart.forEach(item => {
      const priceNum = parseFloat(item.price.replace(/[^0-9\.]/g, ""));
      if (!isNaN(priceNum)) {
        total += priceNum * item.quantity;
      }
    });
    return total.toFixed(2);
  }

  const checkoutModal = document.getElementById("checkout-modal");
  const checkoutForm = document.getElementById("checkout-form");
  const formError = document.getElementById("form-error");
  const paymentSuccess = document.getElementById("payment-success");
  const payUponArrivalBtn = document.getElementById("pay-upon-arrival-btn");

  payUponArrivalBtn.addEventListener("click", function() {
    const name = checkoutForm.elements["name"].value.trim();
    const phone = checkoutForm.elements["phone"].value.trim();
    const address = checkoutForm.elements["address"].value.trim();

    if (!name || !phone || !address) {
      formError.textContent = "Please fill out name, phone, and address.";
      formError.style.display = "block";
      return;
    }
    formError.style.display = "none";

    let message = "KRAVIN DELIVERY Order:%0A";
    cart.forEach(item => {
      message += `- ${item.name} x${item.quantity} (${item.price})%0A`;
    });
    message += `%0ATotal: $${calculateTotal()}%0A%0A`;
    message += `Name: ${name}%0APhone: ${phone}%0AAddress: ${address}`;

    const whatsappNumber = "18763422293";
    const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${message}`;
    window.open(whatsappUrl, "_blank");

    closeCheckout();
  });

  function openCheckout() {
    formError.style.display = "none";
    paymentSuccess.style.display = "none";
    checkoutForm.style.display = "block";
    checkoutModal.style.display = "flex";
    renderPayPalButtons();
  }

  function closeCheckout() {
    checkoutModal.style.display = "none";
    checkoutForm.reset();
    paymentSuccess.style.display = "none";
    formError.style.display = "none";
    document.getElementById("paypal-button-container").innerHTML = "";
  }

  function renderPayPalButtons() {
    const container = document.getElementById("paypal-button-container");
    container.innerHTML = "";

    paypal.Buttons({
      style: {
        layout: 'vertical',
        color:  'gold',
        shape:  'rect',
        label:  'paypal'
      },
      onClick: function(data, actions) {
        if (!checkoutForm.checkValidity()) {
          formError.textContent = "Please fill out all required fields correctly.";
          formError.style.display = "block";
          return actions.reject();
        }
        formError.style.display = "none";
        return actions.resolve();
      },
      createOrder: function(data, actions) {
        const total = calculateTotal();
        return actions.order.create({
          purchase_units: [{
            amount: {
              value: total
            },
            description: "KRAVIN DELIVERY order"
          }]
        });
      },
      onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
          paymentSuccess.style.display = "block";
          checkoutForm.style.display = "none";

          // Clear cart after payment success
          cart.length = 0;

          // You can send order details to backend here

        });
      },
      onError: function(err) {
        formError.textContent = "Payment failed: " + err;
        formError.style.display = "block";
      }
    }).render("#paypal-button-container");
  }

  // For demo: Open checkout modal automatically (remove in prod)
  openCheckout();
</script>

</body>
</html>
